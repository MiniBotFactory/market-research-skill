# 角色协作协议

本文档定义市场调研 Skill 中各角色之间的交接标准、沟通格式和协作机制。

## 核心原则

### 1. 结构化交接（Structured Handoff）

每个角色完成工作后，必须输出标准格式的「交接文档」，再触发下一角色。
禁止非结构化传递（如"这是我找到的一些信息，你来看看"）。

**交接文档格式**：
```markdown
## 交接：[来源角色] → [目标角色]
**任务编号**：[项目ID]-[步骤编号]
**完成时间**：[时间戳]
**状态**：✅ 完成 / ⚠️ 部分完成（需说明原因）

### 交付物
[具体内容]

### 关键发现
- 发现 1
- 发现 2

### 注意事项（给下一角色）
- 注意 1：...
- 注意 2：...

### 未解决问题（如有）
- 问题 1：[描述] → 建议处理方式：[...]
```

### 2. 并行执行规则

**可以并行的角色组合**：
- 数据研究员 + 市场情报员（第 2 步的核心并行）
- 多个市场情报员处理不同竞品（当竞品数量 >5 时）

**不可并行的角色**：
- 需求分析师必须在数据收集之前完成
- 首席分析顾问必须等待所有数据收集角色完成
- 质量审核员必须等待报告起草完成

**并行等待机制**：
```
启动并行任务后，等待所有任务完成，再将合并结果传递给首席分析顾问。
不要在任意一个完成后就提前开始分析。
```

### 3. 单一提问原则

- **需求分析阶段**：集中提出所有澄清问题，一次性确认
- **执行阶段**：不得中途向客户提问（除非发现关键数据缺失影响整个项目）
- **如遇关键缺失**：先记录为「假设」继续工作，在报告中标注置信度为「低」，并在交付时说明

### 4. 质量门禁

质量审核员是唯一有权阻止交付的角色：
- **通过**：明确标注「✅ 审核通过，可交付」
- **退回**：列出具体问题清单，返回报告起草
- **最多退回 2 次**：第 3 次如仍有问题，升级给项目经理决策

### 5. 置信度标注

所有数据和结论必须标注置信度：

| 置信度 | 含义 | 标注方式 |
|--------|------|----------|
| 🟢 高 | 多个可信来源印证，数据新鲜（近 1 年） | `[高置信度]` |
| 🟡 中 | 单一可信来源，或数据 1-3 年前 | `[中置信度]` |
| 🔴 低 | 估算、行业类比、缺乏直接数据 | `[低置信度-估算]` |

---

## 角色间交接矩阵

```
需求分析师
    ↓ 交接文档：需求澄清文档
    ↓
项目经理（接收并分配）
    ├──→ 数据研究员（并行）
    └──→ 市场情报员（并行）
              ↓（合并后）
         首席分析顾问
              ↓ 交接文档：分析洞察报告
              ↓
         项目经理（报告起草）
              ↓
         质量审核员
              ↓（通过）
         [交付客户]
```

---

## 委托提示词模板（多代理模式）

在多代理模式下，项目经理使用以下格式委托子代理：

```markdown
TASK: [具体任务描述，一个原子性目标]

ROLE: [角色名称] - 按照 market-research skill 中该角色的标准执行

CONTEXT:
- 项目背景：[...]
- 客户需求：[...]
- 相关资料：[...]

EXPECTED OUTPUT:
- 格式：标准交接文档
- 必须包含：[具体要求]

CONSTRAINTS:
- 不要做：[...]
- 时间范围：[...]
- 数据来源限制：[...]
```

---

## 升级机制

以下情况需要暂停当前工作，将问题上报给项目经理决策：

1. **需求冲突**：发现客户需求之间相互矛盾
2. **数据真空**：关键数据完全不可得，影响核心结论
3. **范围蔓延**：实际工作量超出预期 2 倍以上
4. **时效冲突**：发现无法在截止时间内完成高质量交付

上报格式：
```markdown
⚠️ 升级通知
角色：[当前角色]
问题：[具体问题描述]
影响：[对项目的影响]
选项 A：[处理方案A] → 优点/缺点
选项 B：[处理方案B] → 优点/缺点
建议：[推荐方案]
```
